<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>τ's Blog - Manjaro i3 配置</title>
        <link rel="stylesheet" href="../css/default.css" />
        <link href="../css/prism.css" rel="stylesheet" />
        <link rel="icon" href="../favicon.svg">
    </head>
    <body>
        <header>
            <div class="logo">
                <a href="../">τ's Blog</a>
            </div>
            <nav>
                <a href="../">Home</a>
                <a href="../archive.html">Archive</a>
            </nav>
        </header>

        <main role="main">
            <h1>Manjaro i3 配置</h1>
            <article>
    <div class="light">
        Posted on September 18, 2019
        
            by τ
        
    </div>
    <section>
        <p><img src="../images/manjaro-i3.jpg" /></p>
<p>从 Windows 转战到 Linux 后，我用过 Elementray OS，国产的 Deepin，现在又换到了 Manjaro 。前面两个虽然总体上还算稳定，但是总是有一些小瑕疵让我难以忍受。例如 Deepin 的特效和动画总是有奇怪的线条出现，而且 UI 设计对 MAC OS 的模仿太明显了。</p>
<p>Manjaro 是在 B 站上看到有 up 主推荐知道的。我下载的是 xfce 的版本，然后把桌面环境换成了 i3 。
Manjaro 最好用的应该是它的软件包管理，<code>pacman</code> 比 <code>apt</code> 方便了不少，软件比较全且新，不需要手动添加很多软件源。
使用了大概有一周的时间，稳定性比起 Ubuntu 类的系统有过之而无不及。</p>
<p>下面记录的是我使用的一些软件和我的配置。</p>
<p>[TOC]</p>
<h2 id="pacman-配置">pacman 配置</h2>
<h3 id="添加-archlinuxcn-镜像">添加 ArchlinuxCN 镜像</h3>
<p>我使用的是清华的镜像，配置可以参考 <a href="https://mirror.tuna.tsinghua.edu.cn/help/archlinuxcn/">ArchlinuxCN 镜像使用帮助</a>。</p>
<p>修改配置文件后一定要安装 <code>archlinuxcn-keying</code> 导入 GPG key：<code>sudo pacman -S archlinuxcn-keyring</code>， 否则安装软件会失败。</p>
<h3 id="更换中国源">更换中国源</h3>
<p>这是表现 pacman 比 apt 好用的地方。直接输命令 <code>sudo pacman-mirrors -c China</code> 会自动选择对你来说速度更快的镜像。<code>-c</code> 是 <code>country</code> 的意思。</p>
<h2 id="i3">i3</h2>
<p>i3 是一个平铺式的窗口管理器，所有的操作都可以用键盘直接完成。熟练了 i3 的快捷键后可以极大地提高工作的效率。
我的 i3 配置比较简单，只是添加了几个启动项，把默认的方向快捷键 <code>jkl;</code> 改成 vim 默认的 <code>hjkl</code>，还去掉了不太漂亮的边框。
想要自己增加一些快捷键，可以用 <code>xmodmap</code> 查看一下按键的名称。</p>
<h3 id="xrandr-配置多显示器">xrandr 配置多显示器</h3>
<p>i3 是不会像别的桌面环境自动检测多显示器，需要自己配置外接的显示器。</p>
<p>我这里使用的工具是 <code>xrandr</code>。直接输入这个命令会输出你所用显示器的信息。
我的主显示器是 <code>eDP1</code>，副显示器是 <code>HDMI1</code>。主显示器会自动开启，副显示器不会默认打开。
我可以输入 <code>xrandr --output HDMI1 --auto --right-of eDP1</code> 开启我的副显示器，<code>HDMI1</code> 在 <code>eDP1</code> 右边，所以用了 <code>--right-of</code>。</p>
<p>为了避免每次开机都需要重新输入命令的麻烦，可以写一个脚本在每次 i3 启动时自动检测是否插入副显示器。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!env /bin/bash</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="va">hdmi</span><span class="op">=</span><span class="va">$(</span><span class="ex">xrandr</span> <span class="kw">|</span> <span class="fu">grep</span> <span class="st">'HDMI1 connected'</span><span class="va">)</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="bu">[</span> <span class="st">&quot;</span><span class="va">$hdmi</span><span class="st">&quot;</span> <span class="ot">!=</span> <span class="st">&quot;&quot;</span> <span class="bu">]</span><span class="kw">;</span> <span class="cf">then</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">xrandr</span> <span class="at">--output</span> HDMI1 <span class="at">--auto</span> <span class="at">--right-of</span> eDP1</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">xrandr</span> <span class="at">--output</span> HDMI1 <span class="at">--off</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="cf">fi</span></span></code></pre></div>
<p>在 i3 的配置文件里面将上面的脚步添加为 <code>exec_always</code>。这样每次启动的时候，可以自动决定是否开启副显示器。
如果在运行过程中卸载或装载显示器，可以通过快捷键重启 i3。</p>
<h3 id="i3lock">i3lock</h3>
<p>i3lock 是锁屏软件。
我使用的是一个 fork 版本 <a href="https://github.com/PandorasFox/i3lock-color">i3lock-color</a>,
它比原版增加了颜色的设置。</p>
<p>下面是我的启动脚步，用到了截图软件 <code>scrot</code>：</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="va">TMPBG</span><span class="op">=</span>/tmp/screen.png</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="ex">scrot</span> <span class="va">$TMPBG</span> <span class="kw">&amp;&amp;</span> <span class="ex">convert</span> <span class="va">$TMPBG</span> <span class="at">-scale</span> 5% <span class="at">-scale</span> 2000%  <span class="va">$TMPBG</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">i3lock</span> <span class="dt">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-i</span> <span class="va">$TMPBG</span> <span class="dt">\</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">--insidecolor</span><span class="op">=</span>0000001c <span class="dt">\</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">--ringcolor</span><span class="op">=</span>0000003e   <span class="dt">\</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">--linecolor</span><span class="op">=</span>00000000   <span class="dt">\</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">--keyhlcolor</span><span class="op">=</span>ffffff80   <span class="dt">\</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">--ringvercolor</span><span class="op">=</span>ffffff00 <span class="dt">\</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">--separatorcolor</span><span class="op">=</span>22222260 <span class="dt">\</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">--insidevercolor</span><span class="op">=</span>ffffff1c <span class="dt">\</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">--ringwrongcolor</span><span class="op">=</span>ffffff55 <span class="dt">\</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">--insidewrongcolor</span><span class="op">=</span>ffffff1c <span class="dt">\</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">--verifcolor</span><span class="op">=</span>ffffff00 <span class="dt">\</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">--wrongcolor</span><span class="op">=</span>ff000000  <span class="dt">\</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">--timecolor</span><span class="op">=</span>ffffff00 <span class="dt">\</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">--datecolor</span><span class="op">=</span>ffffff00 <span class="dt">\</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">--layoutcolor</span><span class="op">=</span>ffffff00</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> <span class="va">$TMPBG</span></span></code></pre></div>
<p>锁屏界面：
<img src="../images/manjaro-i3-lock.jpg" /></p>
<hr />
<p>i3 的具体的配置可以看看我的<a href="https://github.com/yangtau/dotfiles/tree/master/i3">i3 配置</a>.</p>
<h2 id="polybar">polybar</h2>
<p><img src="../images/manjaro-i3-bar.jpg" /></p>
<p>i3 也有一个 bar 叫 i3-status, 简单的显示足够了，想要更丰富的信息显示可以使用 polybar。</p>
<p>polybar 的配置最麻烦了。要想得到比较好看的效果最好在别人的基础上修改。
我的配置文件是在 <a href="https://github.com/adi1090x/polybar-themes">polybar-theme</a> 的基础上修改而来的，增加了一些 module 和多显示器的支持。
配置文件需要根据自己的硬件修改，官方的<a href="https://github.com/polybar/polybar/wiki">文档</a>有详尽的说明。</p>
<h2 id="alacritty">Alacritty</h2>
<p>我把终端模拟器从 xfce-terminal 换到了 <a href="https://github.com/jwilm/alacritty/">Alacritty</a>。</p>
<p>这个终端模拟器支持 GPU 加速，所有配置需要通过修改配置文件完成。它比较简单而且性能很好。</p>
<p>多显示器下，它不会自动根据显示器的 DPI 缩放内容，所以在不同的屏幕上文字的大小不一样。
这个问题这样通过在配置文件中添加 <code>WINIT_HIDPI_FACTOR</code> 环境变量解决，具体可以看看 github 上相关 <a href="https://github.com/jwilm/alacritty/issues/1339">Issues</a>。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">env</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">	</span><span class="fu">WINIT_HIDPI_FACTOR</span><span class="kw">:</span><span class="at"> </span><span class="st">'1.6'</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">...</span></span></code></pre></div>
<h2 id="其他软件">其他软件</h2>
<ul>
<li><a href="https://github.com/davatorium/rofi">rofi</a> 可以作为一个启动器使用，功能很强大。</li>
<li><a href="https://github.com/robbyrussell/oh-my-zsh">oh-my-zsh</a> 我的 shell 是 zsh ，当然要用 oh my zsh。</li>
<li><del><a href="https://github.com/tryone144/compton.git">compton</a> 这个是一个原版的 fork ，可以实现毛玻璃效果。</del></li>
<li><a href="https://github.com/yshui/compton">compton</a> 切换回了 Archlinux 库中的版本，上面的版本在浏览器渲染的时候 CPU 占用率很高。</li>
<li><a href="https://neovim.io/">nvim</a> 从 vim 切换到了 nvim。无痛切换，因为我才入坑 vim 不久 :) 。</li>
<li><a href="https://github.com/skilion/onedrive.git">onedrive</a> 一个命令行的 onedrive, 用 D 语言构建，目前感觉很好用。</li>
<li><a href="https://github.com/varietywalls/variety">variety</a> 自动切换壁纸。</li>
</ul>
<h2 id="问题与解决方案">问题与解决方案</h2>
<p>i3 不像其他完整的桌面环境提供所以设置的图形界面，所以很多操作需要通过命令来完成。
对 Linux 不精通的人来说，这是个让人头痛的事。
下面记录一些我遇到的问题和我的解决方案。</p>
<h3 id="触控板配置">触控板配置</h3>
<p>触控板默认的滑动方向我不是很习惯，而且不能轻触点击。我添加了配置改变触控板的默认设置，具体的文档可以参考 <a href="https://wiki.archlinux.org/index.php/Libinput">libinput</a>。</p>
<p>下面是我的配置，配置文件需要放在 <code>/usr/share/X11/xorg.conf.d/</code> 目录下。</p>
<pre class="conf"><code>Section &quot;InputClass&quot;
    Identifier &quot;touchpad&quot;
    Driver &quot;libinput&quot;
    MatchIsTouchpad &quot;on&quot;
    Option &quot;Tapping&quot; &quot;on&quot;
    Option &quot;AccelSpeed&quot; &quot;0.6&quot;
    Option &quot;HorizontalScrolling&quot; &quot;on&quot;
    Option &quot;NaturalScrolling&quot; &quot;True&quot;
EndSection</code></pre>
<h3 id="亮度调节">亮度调节</h3>
<p>没有装 nvidia 显卡驱动之前，使用 xbacklight 是可以调节的，之后失效(<code>sudo pacman -S xorg-xbacklight</code> 安装 xbacklight)。</p>
<p>在网上查了一圈发现还有一个可以调节亮度的工具 <a href="https://github.com/haikarainen/light">light</a>, manjaro 下可以直接 <code>sudo pacman -S light-git</code> 安装。</p>
<p><strong>注意</strong>：你的用户需要加入 <code>video</code> 用户组，可以通过 <code>sudo gpasswd -a [your_user_name] video</code> 来添加。</p>
<h3 id="compton-开启后-chrome-占用大量-cpu-资源">compton 开启后 Chrome 占用大量 CPU 资源</h3>
<p>我最开始使用 compton 的时候发现 Chrome 在渲染比较复杂的网页或者播放视频的时候， CPU 的使用率会特别的高。
关闭 compton 之后又会恢复正常。</p>
<p>所以我换回了 Archlinux 软件库里面的 compton 版本。
配置文件也是在这个版本的 github 仓库中的 <a href="https://github.com/yshui/compton/blob/next/compton.sample.conf">sample</a> 上修改而来， 主要就把 <code>backend</code> 的默认值 <code>xrender</code> 改成了 <code>glx</code> (需要根据自己的电脑修改)。</p>
<h2 id="最后">最后</h2>
<p>我的部分配置文件放在了 github 上 <a href="https://github.com/yangtau/dotfiles">dotfiles</a>。</p>
<p>自己手动配置了很多东西后才发现开源的可贵，我现在使用的大多数软件都是开源的。感谢所有为开源软件做贡献的开发人员，他们为我们提供了无数的好用的软件。希望我在不久的将来也能为开源软件做点贡献。</p>
    </section>
</article>

        </main>

        <footer>
            Site proudly generated by
            <a href="http://jaspervdj.be/hakyll">Hakyll</a>
        </footer>
    </body>

    <script src="../js/prism.js"></script>

</html>
