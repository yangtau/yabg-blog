---
title: 暑期实习面试：腾讯
date: 2020-04-07
template: post-code
author: τ
hide: true
---

我在大二就已经投了简历到腾讯，当时是想找个暑期实习。不幸的是，简历投出去就石沉大海，了无音讯。直到上学期期末的时候才第一次收到面试邀请。因为已经临近期末，而且岗位也不喜欢，就直接拒了。今年年初的时候，又收到了面试的邀请。因为当时挺怀疑自己的专业能力，挺想通过面试看看自己到底怎么样，于是接受了面试。这次面试几乎完全没有任何准备，也是我人生中第一次找工作的面试，毫无经验可言。

令我开心的是，第一次就拿到了 offer，而且也更加看清了自己吧。下面简单记录一下面试的经历，供大家参考。

## 一面

一面主要是手撕代码，和一些基础知识考察。

本来以为会有个暖场的自我介绍，没想到面试官开门见山，让我写一个 `ToString` 的函数。函数的声明如下：

```c
const char *ToString(int a);
```

这个问题本来挺简单的，但是第一次，我太紧张了，竟然不知该从何下手。先定义了几个变量，malloc 了空闲内存。思维还是非常混乱，像是回到了几年前那个闷热的下午：我坐在高考考场上，不停颤抖的手在理综试卷上来来回回，手心满是汗水。

磨磨蹭蹭了很久，写了如下实现：

```c
const char *ToString(int a) {
  char *s = malloc(sizeof(char) * 20);
  char *t = malloc(sizeof(char) * 20);
  int len = 0;

  while (a) {
    s[len++] = '0' + (a % 10);
    a /= 10;
  }

  int i = 0;
  for (; i < len; i++) {
    t[i] = s[len - i - 1];
  }
  t[i] = '\0';

  return t;
}

```

面试官问：这个实现有什么问题？我马上反应过来没有考虑负数的情况，于是开始改代码。在修改的过程中又发现了忽略了0。

于是代码被改成下面这样这幅丑陋的模样：
```c
const char *ToString(int a) {
  if (a == 0)
    return "0";
  char *s = malloc(sizeof(char) * 20);
  char *t = malloc(sizeof(char) * 20);
  int sign = 0;

  if (a < 0) {
    sign = 1;
    a = -a;
  }

  int len = 0;

  while (a) {
    s[len++] = '0' + (a % 10);
    a /= 10;
  }

  int i = 0;
  if (sign)
    t[i++] = '-';

  while (len--) {
    t[i++] = s[len];
  }
  t[i] = '\0';

  return t;
}
```

面试官问：这个实现有什么问题？我不确定地说，内存分配。面试官说先忽略这个，还有什么问题。我又马上想到了“最大的负数”这种特殊情况,对它取负的结果依然是最大的负数。

接着把代码改成了这样（询问了面试官可以假设 int 是 32bits 大小）：
```c
const char *ToString(int a) {
  int64_t v = a;
  if (v == 0)
    return "0";
  char *s = malloc(sizeof(char) * 20);
  char *t = malloc(sizeof(char) * 20);
  int sign = 0;

  if (v < 0) {
    sign = 1;
    v = -v;
  }

  int len = 0;

  while (v) {
    s[len++] = '0' + (v % 10);
    v /= 10;
  }

  int i = 0;
  if (sign)
    t[i++] = '-';

  while (len--) {
    t[i++] = s[len];
  }
  t[i] = '\0';

  return t;
}
```

面试官接着问，怎么解决上面提到的内存的问题。我回答，使用局部静态数组。
接着改代码（当时的代码已经忘记了，大概意思是这样）：
```c
const char *ToString(int a) {
  int64_t v = a;
  if (v == 0)
    return "0";
  char s[20];
  static char t[20];
  int sign = 0;

  if (v < 0) {
    sign = 1;
    v = -v;
  }

  int len = 0;

  while (v) {
    s[len++] = '0' + (v % 10);
    v /= 10;
  }

  int i = 0;
  if (sign)
    t[i++] = '-';

  while (len--) {
    t[i++] = s[len];
  }
  t[i] = '\0';

  return t;
}
```

面试官继续问，怎么优化。我回答说可以只用一次循环。然后继续改代码：
```c
const char *ToString(int a) {
  static char t[20];
  int64_t v = a;
  int sign = 0;
  int len = 18;

  t[19] = '\0';

  if (v == 0) {
    t[len--] = '0';
  } else if (v < 0) {
    sign = 1;
    v = -v;
  }

  while (v) {
    t[len--] = '0' + (v % 10);
    v /= 10;
  }
  if (sign) t[len--] = '-';

  return t + len + 1;
}
```

然后面试官对这这个函数的实现开始提了些问题：

- 对调用者的要求。因为是局部静态变量，所以调用者对返回值只能读，不能做其他操作。而且，如果再次调用该函数，之前的返回结果就失效了。这两点我回答出来了。
- 多线程的情况。显然，这个函数不能直接用于多线程使用。我提到了可以使用互斥信号量，在两次调用直接必须用PV操作保护返回值的访问。然后面试官提到了给不同线程提供不同的局部静态数组，这个问题我就完全不懂了。后来查了一下，有个叫 thread-local storage 的技术，应该是面试官想要考试的。
- `printf("%s %s", ToString(4), ToString(5))` 的输出。由于是局部变量，而且默认压栈方式是从右至左，所以输出 `4 4`。但是我马上又想起 `printf` 的参数是不确定的，压栈方式可能不一样。于是我又回答说可能是 `5 5`，并且老实承认自己不确定 `printf` 的压栈方式（其实只需要稍微冷静思考一下就知道 `printf` 还是从右至左压栈，因为正是这样才能通过第一个参数中的 `%` 个数，确定之后的参数个数）。

之后结束了代码测试，面试官给我打了电话，接着电话面试。我们接着上面上面的压栈问题聊了聊，然后又问了一些 x86 汇编的知识。

最后一个问题是大数据处理的算法问题。至今没有想到好的解法。问题是这样的：100台机器，每个机器上有1TB排好序的数据，从中找出中位数。当时想了半天，说出了归并，显然不是面试官想要的结果。

面试官最后让我提问。我怂了，没敢问什么。是滴，怂到了啥都不敢问🤪。然后面试就在略微尴尬的氛围中结束了。

## 二面

大概在一个月之后（在早就我以为我的第一面试已经挂了之后），没有收到任何提前提醒，突然收到腾讯的短信短信，说大概一个小时后开始电话面试。虽然除了多半要凉的心态就没有别的准备了，我还是接受了面试。

十点半的时候，腾讯面试官的来电准时到达。先让我自我介绍一下。面试前的一个小时，我刚好写了一篇自我介绍的稿子，然后就读了读。然后面试官问了我喜欢的领域，为什么，我如实回答了。然后来简单了聊了一下做过的项目，没有特别深入地问。之后面试官要了我的 Github 账号，说看看我的项目。

就在我以为要开始刁钻的技术问题的轰炸的时候，面试官突然开始问我平时除了专业还有什么兴趣爱好。之后的谈话就变得非常愉快。

“喜欢读书。”

“最近读了些什么书？”

“存在主义。”

“讲讲什么是存在主义。”

“…”。我就瞎讲了一大堆，扯了扯理性主义的没落，还有马克思的异化理论🤣。

之后面试官又问我读哪些作家。我就开始把陀思妥耶夫斯基安利给面试官😂。

后面还聊到了马拉松，面试官应该也是个喜欢跑马拉松的人，所以我们聊的非常快乐。面试官不停地说“挺好”，“挺好”😁。

之后，轮到我提问了。因为之前提到了程序员 35 岁危机的问题。我就问了面试官，腾讯内这种情况严重吗，我想做技术做到老可能吗。面试官觉得网上夸大了这个情况，他说腾讯 35+ 还在写代码的人还是挺多，当然也有很多人转到管理，或者做技术方面 leader。

最后，他说因为之前一面的时候同事已经问了我很多技术问题了，所以他就不问了。于是，面试就这样愉快地结束了。

## 总结

因为是第一面试，没有什么经验，所以我其实内心特别地慌。一面的时候，其实一开始就能把代码写得更好一些。还好面试官每次提醒一下，我就马上反应过来了。二面也太轻松愉快了，没想到我这么能聊。我现在有一种我是混进过去的感觉😂。

一点经验：

- 自信。太紧张真的会影响发挥。
- 基础很重要。一面的问题其实是特别基础的，但是如果对 C 语言不熟，还是很难回答好。
- 多读点书。多读书真的能让人“风生水起” 😏。
